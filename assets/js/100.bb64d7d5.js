(window.webpackJsonp=window.webpackJsonp||[]).push([[100],{435:function(s,a,t){"use strict";t.r(a);var e=t(13),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("[TOC]")]),s._v(" "),t("h1",{attrs:{id:"查看是否由-mysql-引起"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看是否由-mysql-引起"}},[s._v("#")]),s._v(" 查看是否由 MySQL 引起")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("top")]),s._v("  命令查看是否是 由 "),t("code",[s._v("MySQL")]),s._v(" 导致的 CPU爆满， 如果是进行下一步")]),s._v(" "),t("h1",{attrs:{id:"解决问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决问题"}},[s._v("#")]),s._v(" 解决问题")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("登陆mysql ， 使用命令"),t("code",[s._v("show processlist")]),s._v(" 查看正在处理的请求")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("+----+-------------+-----------+------+---------+------+------------\n| Id | User        | Host      | db   | Command | Time | State \n+----+-------------+-----------+------+---------+------+------------\n\n")])])])]),s._v(" "),t("li",[t("p",[s._v("找到 "),t("code",[s._v("Time")]),s._v("  字段处理时间较高的线程")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("kill 线程id")]),s._v(" 杀死该线程")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mysql>  kill 103\n")])])])])]),s._v(" "),t("h1",{attrs:{id:"优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化"}},[s._v("#")]),s._v(" 优化")]),s._v(" "),t("h2",{attrs:{id:"explain-查看执行计划"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#explain-查看执行计划"}},[s._v("#")]),s._v(" explain 查看执行计划")]),s._v(" "),t("ol",[t("li",[s._v("复制刚才请求较慢的线程的   "),t("code",[s._v("Info")]),s._v(" 字段中的 "),t("code",[s._v("SQL")]),s._v(" 语句")]),s._v(" "),t("li",[s._v("使用 "),t("code",[s._v("explain")]),s._v("  查看执行计划， 进行优化。")])]),s._v(" "),t("p",[s._v("一般情况下， 查询花费的时间主要会花在 "),t("code",[s._v("order by")]),s._v(" ， "),t("code",[s._v("group by")]),s._v(" , "),t("code",[s._v("批量操作")]),s._v(" ， "),t("code",[s._v("嵌套查询")]),s._v(" 上， 所以要重点关注这些sql语句")]),s._v(" "),t("h2",{attrs:{id:"开启慢查询日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启慢查询日志"}},[s._v("#")]),s._v(" 开启慢查询日志")]),s._v(" "),t("p",[s._v("配置文件作出修改")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[mysqld]\nslow_query_log=1  #开启慢查询\nlong_query_time=5 #慢查询时间\nlog-slow-queries = /var/log/mysql/slowquery.log #需有写入权限\n\n")])])]),t("p",[s._v("通过查看log日志， 可以简单的查看慢SQL")]),s._v(" "),t("h2",{attrs:{id:"合理建立索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#合理建立索引"}},[s._v("#")]),s._v(" 合理建立索引 ？")]),s._v(" "),t("p",[s._v("查询过慢， 首先使用explain查看是否查询类型是全表扫描 "),t("code",[s._v("ALL")]),s._v(" ， 再观察 "),t("code",[s._v("where")]),s._v(" 条件后面的字段是否使用索引， 还有索引是否合理， 向下面这个例子就是不合理的索引")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v("  a  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("left")]),s._v(" jion b "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 索引在  a.id , b.id 没有")]),s._v("\n")])])]),t("p",[s._v("左连接是以左表为主表 的查询， 所以需要使用右表来限制左表的数据 ， 所以不合理")]),s._v(" "),t("h2",{attrs:{id:"索引失效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#索引失效"}},[s._v("#")]),s._v(" 索引失效 ？")]),s._v(" "),t("p",[s._v("这就是不合理的使用索引， 或者是索引已经失效")]),s._v(" "),t("p",[s._v("以下这些情况， 会直接导致索引失效")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("索引字段做"),t("code",[s._v("运算")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v("  a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])])])]),s._v(" "),t("li",[t("p",[s._v("索引条件后 使用 "),t("code",[s._v("or")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v("  a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("or")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangsan'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),t("li",[t("p",[s._v("使用 "),t("code",[s._v("左前缀")]),s._v(" 模糊查询 "),t("code",[s._v("like %xx")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v("  a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%an'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v("  a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%an%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),t("li",[t("p",[s._v("使用"),t("code",[s._v("IS NULL")]),s._v(" 、 "),t("code",[s._v("IS NOT NULL")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v("  a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v("\n")])])])])]),s._v(" "),t("p",[s._v("其他情况：  使用  "),t("code",[s._v("<>")]),s._v("   、"),t("code",[s._v("not in")]),s._v("   、 "),t("code",[s._v("not exist")]),s._v(" 、 "),t("code",[s._v("!=")]),s._v("  ， 会降低查询效率")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);