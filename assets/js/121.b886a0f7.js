(window.webpackJsonp=window.webpackJsonp||[]).push([[121],{601:function(s,t,a){"use strict";a.r(t);var e=a(13),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("命令:")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("MULTI")]),s._v(" : 标记一个事务块开始")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("DISCARD")]),s._v(" :  丢弃所有 MULTI 之后发的命令")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("EXEC")]),s._v(":    执行所有 MULTI 之后发的命令")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("UNWATCH")]),s._v(" : 取消事务命令")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("WATCH key [key ...]")]),s._v(" : 锁定 key直到执行了 MULTI/EXEC命令")])])]),s._v(" "),a("h2",{attrs:{id:"正常的执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正常的执行"}},[s._v("#")]),s._v(" 正常的执行")]),s._v(" "),a("p",[s._v("没有异常的执行命令")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" MULTI  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启事务")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k1 vvvv "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#执行命令, 命令会进入 QUEUE")]),s._v("\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v("  k2 sssss\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" EXEC   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#提交事务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" OK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" OK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" get k1\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vvvv"')]),s._v("\n")])])]),a("h2",{attrs:{id:"非正常的执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#非正常的执行"}},[s._v("#")]),s._v(" 非正常的执行")]),s._v(" "),a("h3",{attrs:{id:"提交命令抛错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提交命令抛错"}},[s._v("#")]),s._v(" 提交命令抛错")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" MULTI  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开始事务")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k1 vvvvv  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#正常")]),s._v("\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k2 nnnnnn  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#正常")]),s._v("\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" getaaa  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#抛出异常")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ERR unknown "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("getaaa"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(", with args beginning with: \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k3 mmmmmm "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#再执行其他")]),s._v("\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" EXEC   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#提交事务,所有命令不执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" EXECABORT Transaction discarded because of previous errors.\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" get k2\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sssss"')]),s._v("\n\n")])])]),a("blockquote",[a("p",[s._v("结果: 所有命令都被抛弃, 没有执行")])]),s._v(" "),a("h3",{attrs:{id:"执行命令抛错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行命令抛错"}},[s._v("#")]),s._v(" 执行命令抛错")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" MULTI  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开始事务")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11111")]),s._v("\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v("  k2 ssssss\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" INCR k2  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#提交执行后才出错")]),s._v("\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" get  k1\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" EXEC "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#提交")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" OK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" OK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ERR value is not an integer or out of range\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"11111"')]),s._v("\n\n")])])]),a("blockquote",[a("p",[s._v("仅出错的语句没有执行, 其他命令正常执行")])]),s._v(" "),a("h2",{attrs:{id:"放弃事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#放弃事务"}},[s._v("#")]),s._v(" 放弃事务")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" MULTI   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开始事务")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v(" \nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v("  k2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2222")]),s._v("\nQUEUED\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" DISCARD "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#放弃事务")]),s._v("\nOK\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" get k1\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vvvv"')]),s._v("\n\n")])])]),a("h2",{attrs:{id:"watch-监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#watch-监控"}},[s._v("#")]),s._v(" Watch 监控")]),s._v(" "),a("p",[s._v("当被Watch的 "),a("code",[s._v("key")]),s._v(" 在 事务 "),a("code",[s._v("提交之前")]),s._v(" 被 "),a("code",[s._v("修改")]),s._v(" , "),a("code",[s._v("事务失败")]),s._v("   (相当于 数据库的 "),a("code",[s._v("乐观锁")]),s._v(")")]),s._v(" "),a("p",[s._v("工作流程:")]),s._v(" "),a("ol",[a("li",[s._v("线程A  "),a("code",[s._v("watch")]),s._v("  一个 "),a("code",[s._v("key")])]),s._v(" "),a("li",[s._v("A 开始事务")]),s._v(" "),a("li",[s._v("中间其他 线程B 修改key的值")]),s._v(" "),a("li",[s._v("A 提交事务")]),s._v(" "),a("li",[s._v("A发现 key 被修改了, 事务失败")])])])}),[],!1,null,null,null);t.default=r.exports}}]);