(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{423:function(t,e,n){"use strict";n.r(e);var a=n(13),i=Object(a.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"表设计规范-建议"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#表设计规范-建议"}},[t._v("#")]),t._v(" 表设计规范（建议)")]),t._v(" "),n("p",[t._v("建数据库表的时候请指定下编码为 "),n("code",[t._v("utf8mb4")]),t._v("\n1、数据库名、表名、字段名都 "),n("code",[t._v("小写")]),t._v(" ，名字越短越好，务必精炼；索引命名：普通索引 - idx_col_name 唯一索引 - uniq_col_name\n2、字段名字如有多个词组就用下划线分割，表名和数据库不建议有分隔符号\n3、单库不超过300个表\n4、单表字段数不超过50个字段以上 --- "),n("em",[t._v("控制单行数据长度。默认情况下，innodb每个数据页为16k，至少存储2行数据，若行数据超过8k则会发生行溢出，导致IO繁忙")]),t._v("\n5、不允许用mysql保留字作为字段名\n6、能用tinyint就不要用smallint，能用smallint就不要用int，能用int就不要用bigint --- "),n("em",[t._v("精简数据库存储")]),t._v("\n7、如需存储用户ip，则用int型存储，不要用char --"),n("em",[t._v("- 整型 要比 字符类型存储效率高")]),t._v("\n9、表及字段必须有注释\n8、标识位，如（type/status）类型字段，尽量使用 - tinyint 类型\n10、mysql引擎使用 innodb\n11、前台表必须有主键，并且采用整形递增设计，主键ID，建议建议表名+id;如表member，主键ID为：member_id --- "),n("em",[t._v("1、整型数据存储效率略高于字符串；2、innodb数据存储按照主键顺序存储，整型递增可优化数据插入效率；3、后期的可持续化管理（数据排序、数据清理等）")]),t._v("\n12、根据合适的查询条件建立合适的索引，查询条件顺序必须和索引顺序一一对应\n13、前台业务，禁止使用关联查询（join）\n14、in 句型若条件为字符串，需控制在100个以内 --- in 对整型无限制， 字符串类型数据，超过200个左右，会导致索引失效\n15、时间类字段使用bigint存储到毫秒\n16、对于大表（单分片超过千万级别）的表结构变更，开发初期请找DBA进行商讨方案。建议尽量采用关联新表的方式进行处理")]),t._v(" "),n("h2",{attrs:{id:"数据库禁止事项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据库禁止事项"}},[t._v("#")]),t._v(" 数据库禁止事项")]),t._v(" "),n("p",[t._v("10、禁止使用联合主键设计 ---\n11、禁止使用text或blob数据类型；")]),t._v(" "),n("p",[t._v("--- 禁用text 或 blob的原因：现有的业务线采用的为utf8mb4字符集，单字符占用4字节，若存储字段数据过长，如按2000来算，那么每次需要的从磁盘取8k的数据，并且需通过网络传输给客户端。")]),t._v(" "),n("p",[t._v("--- 当然，偶尔少量的这样字段存在也不是说完全不可以。完全是怕大家养成习惯，无限制的存储大字段，且，对于该表的查询有可能会被在代码中作为查询模板（每次查询都会涉及该大字段的查询），后期量大的话，IO和网络带宽成为瓶颈的可能性大大增加。")]),t._v(" "),n("p",[t._v("--- 因此建议：blob、text字段尽量转为简化长度，并选择varchar(1000) 以内。超过varchar(256) 建议拆表，若超过1000 必须将该字段拆出之新表进行主键关联。")]),t._v(" "),n("p",[t._v("12、字段必须采用not null设计。\n13、禁止使用外键，不允许在mysql里做任何计算\n14、对于非配置表，禁止使用like查询\n15、禁止在事物种添加select 语句，保持事务短小，与事务无关操作放到事务外面\n16、禁止使用存储过程和触发器\n17、禁止使用select ＊，尽可能不要带上该业务不需要的字段\n18、禁止使用or，如有多条件并行查询语句，可使用union语句\n19、非配置类数据表，禁止使用 负向查询 NOT、!=、<>、!<、!>、NOT EXISTS、NOT IN、 NOT LIKE --- 索引失效问题\n20、禁止通过跳板机使用可写账号登录数据库\n21、varchar超过1000长度，需将该字段拆分出原表 --- "),n("em",[t._v("控制单行数据长度。默认情况下，innodb每个数据页为16k，至少存储2行数据，若行数据超过8k则会发生行溢出，导致IO繁忙")])]),t._v(" "),n("h2",{attrs:{id:"一些注意点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一些注意点"}},[t._v("#")]),t._v(" 一些注意点")]),t._v(" "),n("h3",{attrs:{id:"重复insert问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#重复insert问题"}},[t._v("#")]),t._v(" 重复Insert问题")]),t._v(" "),n("ol",[n("li",[t._v("先使用cacheService.setnx(String key, int expireSecond, String value)方法来防止并发操作，该方法的返回值=1(long类型)，表示没有并发，如果返回值=0，表示已有操作在进行，可直接抛出业务异常(BizValidateException或BizException均可)。")]),t._v(" "),n("li",[t._v("步骤1验证通过后，先查询DB中是否存在该数据，存在时直接返回业务异常，不存在时才进行insert操作(该步骤目的是防止dubbo处理超时客户端再次提交导致的重复Insert)。")])]),t._v(" "),n("blockquote",[n("p",[t._v("注：可以配合唯一索引一起使用。")])]),t._v(" "),n("h3",{attrs:{id:"update或delete操作结束后缓存和db中数据不一致的几种解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#update或delete操作结束后缓存和db中数据不一致的几种解决方案"}},[t._v("#")]),t._v(" update或delete操作结束后缓存和DB中数据不一致的几种解决方案")]),t._v(" "),n("ol",[n("li",[t._v("尽可能不使用事务。")]),t._v(" "),n("li",[t._v("方法最后再使用cacheService.del(String key)方法清一次缓存。")]),t._v(" "),n("li",[t._v("尽可能将update操作放在方法的最后执行，将操作时间较长的处理放在前面(例如调用Remote处理)。")])]),t._v(" "),n("h3",{attrs:{id:"数据记录相关注意项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据记录相关注意项"}},[t._v("#")]),t._v(" 数据记录相关注意项")]),t._v(" "),n("p",[t._v("1、整形数据类型（int/bigint/smallint/tinyint）都有固定的存储范围，其后面所跟的数字只有显示位宽限定，无数据存储范围约定效果\n2、单行数据应尽量简短（数据长度）。最长长度不可超过7k。 预防行溢出而导致的io问题")]),t._v(" "),n("h3",{attrs:{id:"数据库使用相关注意事项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据库使用相关注意事项"}},[t._v("#")]),t._v(" 数据库使用相关注意事项")]),t._v(" "),n("ol",[n("li",[t._v("新增/修改SQL语句需要评审")]),t._v(" "),n("li",[t._v("数据库只使用insert,update,select权限，删除用is_valid=0代替，特殊业务授于delete权限")])])])}),[],!1,null,null,null);e.default=i.exports}}]);