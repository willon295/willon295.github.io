---
title: '[Java]ClassLoader类加载'
category: Java
tag: Java
date: 2017-02-02: 00:00:00
---



# 类加载顺序

![](/images/classloader.png)



大致过程

```
加载  -> 验证  -> 准备  -> 解析 -> 初始化  ->  使用  -> 卸载
```

1. 加载

   - 通过类的全限定名，获取其定义的二进制字节流
   - 将字节流代表的存储结构转化成方法区的运行时数据结构（还没有进入方法区）
   - 在 堆中生成一个代表类的对象， 作为对方法区中这些数据 的访问入口

2. 验证  
   确保Class文件中的字节流信息符合当前虚拟机的要求，不会危害虚拟机的安全。大致验证： `文件格式的验证` 、`元数据的验证` 、` 字节码验证` 和 `符号引用验证` 。

   - 文件格式验证： 验证 `字节流` 是否符合 `class` 文件规范
   - 元数据验证： 对数据进行 语法校验，保证其 符合 Java 语法规范
   - 字节码验证： 数据流、控制流分析，确保方法运行不会危害到 JVM
   - 符号引用验证： 对类之外的信息（常量池的各种符号引用） 进行匹配性的校验

3. 准备

   正式为 `类变量 分配内存` 并且设置 `类变量初始值` 的阶段

   - 仅仅包含 static 变量， 不包含实例变量， 实例变量 会在类初始化时进入 `堆 ` 

   - 通常默认值是 `0 ， 0L , null , false` , **不会** 执行显示赋值,如下

     ```java
     public static int a = 3;
     ```

     a=3 会在 `初始化阶段`  执行， 此 准备阶段 `a=0` 

4. 解析
   虚拟机将 `常量池`  中的 `符号引用`  转化为 `直接引用` 

   - 类和接口解析：  判断解析成直接引用还是数组类型
   - 字段解析： 会一直向上层父类解析，直到找到 引用为止，比如 `name` 属性， 如果子类没有， 会一直向上层父类查找
   - 方法解析： 判断该方法处于类还是接口，并且进行对应的解析

5. 初始化
   类加载的最后一步，真正开始执行 Java类中的各个实例的赋值，一个各种变量初始化