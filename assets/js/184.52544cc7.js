(window.webpackJsonp=window.webpackJsonp||[]).push([[184],{557:function(t,e,a){"use strict";a.r(e);var s=a(13),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"数据库触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库触发器"}},[t._v("#")]),t._v(" 数据库触发器")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("为什么要用触发器？\n主要是想要一个log的功能，当管理操作授权时，自动记录管理的操作的对象，时间，作了那些改动。如果用代码实现实在是太蠢了，费时费力。还会出bug。如果用数据库的触发器。当授权表发生改变时,触发器会生效，完成想要的功能。")])]),t._v(" "),a("li",[a("p",[t._v("怎么写？")])])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("添加授权触发器(addtrigger)\n说明：添加授权时自动向日志表插入数据,")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("DROP TRIGGER IF EXISTS `addlog`;\nDELIMITER ;;\nCREATE TRIGGER `addlog` \nAFTER INSERT ON `auth` FOR EACH ROW \ninsert into logauth \n(operatetype,operatetime,username,userurl,authendtime)\n values ('add',now(),new.username,new.userurl,new.authendtime)\n;;DELIMITER ;\n")])])])]),t._v(" "),a("li",[a("p",[t._v("删除授权触发器(deletetrigger)\n说明：删除授权时自动向日志表插入数据。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("DROP TRIGGER IF EXISTS `deletelog`;\nDELIMITER ;;\nCREATE TRIGGER `deletelog` BEFORE DELETE ON `auth` FOR EACH ROW\ninsert into logauth \n(operatetype,operatetime,username,userurl,authendtime) \nvalues\n ('delete',now(),old.username,old.userurl,old.authendtime)\n;;\nDELIMITER ;\n")])])])])]),t._v(" "),a("blockquote",[a("p",[t._v("new 表示新插入的的数据，old 表示原本的数据。before,after是触发的时间")])]),t._v(" "),a("h1",{attrs:{id:"监听器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监听器"}},[t._v("#")]),t._v(" 监听器")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("为什么要监听器")]),t._v(" "),a("p",[t._v("想要这样一个功能：服务器的"),a("code",[t._v("项目启动时")]),t._v("，"),a("code",[t._v("自动定时")]),t._v("的扫描用户的到期时间，和当前时间进行对比，如果小于当前时间，将用户状态设置为无效。")])]),t._v(" "),a("li",[a("p",[t._v("实现")]),t._v(" "),a("ul",[a("li",[t._v("创建一个"),a("code",[t._v("Timer")]),t._v(" 对象，调用"),a("code",[t._v("timer.schedule(TimerTask timertask)")]),t._v("方法")]),t._v(" "),a("li",[t._v("方法传入一个"),a("code",[t._v("timertask")]),t._v("对象")]),t._v(" "),a("li",[t._v("重写"),a("code",[t._v("timertask")]),t._v(" 的"),a("code",[t._v("run()")]),t._v("方法,这里写自动处理的代码；")]),t._v(" "),a("li",[t._v("创建一个"),a("code",[t._v("Listenner")]),t._v(" ,在方法"),a("code",[t._v("contextInitialized(ServletContextEvent sce)")]),t._v("中调用执行方法")])])]),t._v(" "),a("li",[a("p",[t._v("代码实现：")]),t._v(" "),a("p",[t._v("执行任务的工具类")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('public class ScheduleTask {\n/**\n * 用于扫描用户授权 时间，如果时间小于当前时间，则将用户的状态改成无效\n * @throws Exception\n */\npublic void scannerUserState() throws Exception {\n    SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");\n    AuthDAOImpl authDAO = new AuthDAOImpl();\n    TimerTask timerTask = new TimerTask() {\n        @Override\n        public void run() {\n            List authlist = null;\n            try {\n                authlist = authDAO.getActiveAuth();\n                for (Object auths : authlist\n                        ) {\n                    Auth auth = (Auth) auths;\n                        Date authdate = sdf.parse(auth.get_auth_end_time());\n                        if (authdate.before(new Date())) {\n                            authDAO.changeAuthState(auth);\n                    }\n                }\n\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n\n        }\n    };\n    Timer timer = new Timer();\n\t//参数：task 对象，开始时间，执行间隔\n    timer.schedule(timerTask, new Date(), 60000);\n\t}\n}\n')])])]),a("p",[t._v("Listenner的关键代码")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('public void contextInitialized(ServletContextEvent sce) {\n    ScheduleTask s= new ScheduleTask();\n    try {\n        s.scannerUserState();\n    } catch (Exception e) {\n        System.out.println("扫描启动失败");\n    }\n\n}\n')])])])])]),t._v(" "),a("h1",{attrs:{id:"过滤器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#过滤器"}},[t._v("#")]),t._v(" 过滤器")]),t._v(" "),a("p",[t._v("用于登录安全验证、防止url传参进行数据注入。")]),t._v(" "),a("h1",{attrs:{id:"文档整理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文档整理"}},[t._v("#")]),t._v(" 文档整理")]),t._v(" "),a("h2",{attrs:{id:"系统总体架构图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统总体架构图"}},[t._v("#")]),t._v(" 系统总体架构图")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://blogimgs-1252094786.cossh.myqcloud.com/%E5%A4%A7%E4%BA%8C%E4%B8%8B%E8%AF%BE%E8%AE%BE/20170621215143_xtztjgt.jpg",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"系统功能结构图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统功能结构图"}},[t._v("#")]),t._v(" 系统功能结构图")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://blogimgs-1252094786.cossh.myqcloud.com/%E5%A4%A7%E4%BA%8C%E4%B8%8B%E8%AF%BE%E8%AE%BE/20170621215040_xtgnjgt.jpg",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"用例图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用例图"}},[t._v("#")]),t._v(" 用例图")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://blogimgs-1252094786.cossh.myqcloud.com/%E5%A4%A7%E4%BA%8C%E4%B8%8B%E8%AF%BE%E8%AE%BE/20170621214826_usecase.jpg",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"用例规约"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用例规约"}},[t._v("#")]),t._v(" 用例规约")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://blogimgs-1252094786.cossh.myqcloud.com/%E5%A4%A7%E4%BA%8C%E4%B8%8B%E8%AF%BE%E8%AE%BE/20170621214858_ylgy.jpg",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"流程图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#流程图"}},[t._v("#")]),t._v(" 流程图")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://blogimgs-1252094786.cossh.myqcloud.com/%E5%A4%A7%E4%BA%8C%E4%B8%8B%E8%AF%BE%E8%AE%BE/20170621214922_lct.jpg",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"数据库e-r图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库e-r图"}},[t._v("#")]),t._v(" 数据库E-R图")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://blogimgs-1252094786.cossh.myqcloud.com/%E5%A4%A7%E4%BA%8C%E4%B8%8B%E8%AF%BE%E8%AE%BE/20170621214958_e-r.jpg",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"时序图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#时序图"}},[t._v("#")]),t._v(" 时序图")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://blogimgs-1252094786.cossh.myqcloud.com/%E5%A4%A7%E4%BA%8C%E4%B8%8B%E8%AF%BE%E8%AE%BE/20170621215844_sxt.jpg",alt:""}})])])}),[],!1,null,null,null);e.default=r.exports}}]);