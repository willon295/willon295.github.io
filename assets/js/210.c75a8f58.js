(window.webpackJsonp=window.webpackJsonp||[]).push([[210],{596:function(e,t,n){"use strict";n.r(t);var r=n(13),s=Object(r.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"注意事项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[e._v("#")]),e._v(" 注意事项")]),e._v(" "),n("ol",[n("li",[e._v("MapReduce 只能将 "),n("code",[e._v("Reduce")]),e._v(" 的 "),n("code",[e._v("key")]),e._v(" 写入数据库")]),e._v(" "),n("li",[e._v("所以要将 Reduce 的 "),n("code",[e._v("key")]),e._v(" 设置为 "),n("code",[e._v("自定义类型")])]),e._v(" "),n("li",[e._v("自定义类型需要实现接口 "),n("code",[e._v("WritableComparable")]),e._v(" , "),n("code",[e._v("DBwritable")])]),e._v(" "),n("li",[e._v("reduce的输出格式是 "),n("code",[e._v("DBOutputFormat.class")])]),e._v(" "),n("li",[e._v("获取的 properties 属性必须使用， 否则报错 "),n("code",[e._v("NullPointExcption")])])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('Properties p = new Properties();\n// this.getClass.getResourceAsStream 和 绝对路径 `/`\np.load(this.getClass().getResourceAsStream("/db.properties"));\n\n')])])]),n("ol",{attrs:{start:"6"}},[n("li",[n("code",[e._v("DBConfiguration.configureDB()")]),e._v(" 方法第一个参数的 "),n("code",[e._v("configuration")]),e._v(" 参数，必须从 "),n("code",[e._v("job")]),e._v(" 获取，否则 "),n("code",[e._v("DBOutPutFormat.getWriter 异常")]),e._v("，运行失败。")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('DBConfiguration.configureDB(job.getConfiguration(), p.getProperty("driver"), p.getProperty("jdbcUrl"), p.getProperty("username"), p.getProperty("password"));\n//设置数据表， 要插入的列\nDBOutputFormat.setOutput(job, p.getProperty("table"), "uid", "gid", "exp");\n')])])]),n("ol",{attrs:{start:"7"}},[n("li",[n("code",[e._v("mysql-xxx.jar")]),e._v(" 的驱动包拷贝到 "),n("code",[e._v("所有节点")]),e._v(" 的 "),n("code",[e._v("$HADOOP_HOME/share/hadoop/yarn/lib")]),e._v(" 目录")])]),e._v(" "),n("h1",{attrs:{id:"自定义-key类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义-key类型"}},[e._v("#")]),e._v(" 自定义 key类型")]),e._v(" "),n("ol",[n("li",[e._v("自定义的key数据类型不许实现 "),n("code",[e._v("WritableComparable")]),e._v(" , "),n("code",[e._v("DBwritable")]),e._v(" 接口，实现里面的方法")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('public class ResultKey implements WritableComparable, DBWritable {\n\n    private String uid;\n    private String gid;\n    private int exp;\n\n    //从数据库结果集  反序列化相应的属性\n    public void readFields(ResultSet rs) throws SQLException {\n        uid = rs.getString("uid");\n        gid = rs.getString("gid");\n        exp = rs.getInt("exp");\n    }\n\n    //序列化输出  给占位符 填入相应的参数\n    public void write(PreparedStatement ps) throws SQLException {\n        ps.setString(1, uid);\n        ps.setString(2,gid);\n        ps.setInt(3, exp);\n    }\n\n    public int compareTo(Object o) {\n        int res = -1;\n        if (o instanceof ResultKey){\n            ResultKey r = (ResultKey) o;\n            //比较 uid\n            int  a = Integer.parseInt(this.getUid());\n            int  b = Integer.parseInt(r.getUid());\n            res = a > b ? 1 : (a == b) ? 0 : -1;\n\n        }\n        return res;\n    }\n\n\n    @Override\n    public boolean equals(Object o) {\n        if (this == o) return true;\n        if (!(o instanceof ResultKey)) return false;\n\n        ResultKey resultKey = (ResultKey) o;\n\n        if (exp != resultKey.exp) return false;\n        if (!uid.equals(resultKey.uid)) return false;\n        return gid.equals(resultKey.gid);\n    }\n\n    @Override\n    public int hashCode() {\n        int result = uid.hashCode();\n        result = 31 * result + gid.hashCode();\n        result = 31 * result + exp;\n        return result;\n    }\n\n    public void write(DataOutput out) throws IOException {\n        out.writeUTF(uid);\n        out.writeUTF(gid);\n        out.writeInt(exp);\n    }\n\n    public void readFields(DataInput in) throws IOException {\n        this.uid = in.readUTF();\n        this.gid = in.readUTF();\n        this.exp = in.readInt();\n    }\n\n    public String getUid() {\n        return uid;\n    }\n\n    public void setUid(String uid) {\n        this.uid = uid;\n    }\n\n    public String getGid() {\n        return gid;\n    }\n\n    public void setGid(String gid) {\n        this.gid = gid;\n    }\n\n    public int getExp() {\n        return exp;\n    }\n\n    public void setExp(int exp) {\n        this.exp = exp;\n    }\n}\n\n')])])]),n("h1",{attrs:{id:"job配置-demo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#job配置-demo"}},[e._v("#")]),e._v(" job配置 Demo")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('public int run(String[] strings) throws Exception {\n        Configuration conf = getConf();\n        Path in = new Path(conf.get("in"));\n        \n        //加载数据库配置信息\n        Properties p = new Properties();\n        p.load(this.getClass().getResourceAsStream("/db.properties"));\n\n        Job job = Job.getInstance(conf, "saveResult2DB");\n        job.setJarByClass(this.getClass());\n        job.setMapperClass(SaveRecommandResult2DBMapper.class);\n        job.setMapOutputKeyClass(Text.class);\n        job.setMapOutputValueClass(NullWritable.class);\n        job.setInputFormatClass(TextInputFormat.class);\n        TextInputFormat.addInputPath(job, in);\n\n        //设置reducer\n        job.setReducerClass(SaveRecommandResult2DBReducer.class);\n        job.setOutputKeyClass(ResultKey.class);\n        job.setOutputValueClass(NullWritable.class);\n        job.setOutputFormatClass(DBOutputFormat.class);\n\n        //设置数据库连接信息\n        DBConfiguration.configureDB(job.getConfiguration(), p.getProperty("driver"), p.getProperty("jdbcUrl"), p.getProperty("username"), p.getProperty("password"));\n        //设置数据表， 要插入的列\n        DBOutputFormat.setOutput(job, p.getProperty("table"), "uid", "gid", "exp");\n\n        return job.waitForCompletion(true) ? 0 : 1;\n')])])])])}),[],!1,null,null,null);t.default=s.exports}}]);