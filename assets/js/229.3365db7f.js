(window.webpackJsonp=window.webpackJsonp||[]).push([[229],{624:function(t,a,s){"use strict";s.r(a);var e=s(13),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("说白就是 "),s("code",[t._v("多个注册中心")]),t._v(" 之间可以 "),s("code",[t._v("相互注册")]),t._v(" , 实现冗余备份的功能.")]),t._v(" "),s("p",[t._v("那么 "),s("code",[t._v("服务提供者")]),t._v("  就不能只向一台机器注册, 必须 "),s("code",[t._v("同时指定多个注册中心")])]),t._v(" "),s("p",[t._v("这样才能达到注册中心高可用的效果.")]),t._v(" "),s("h1",{attrs:{id:"配置过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置过程"}},[t._v("#")]),t._v(" 配置过程")]),t._v(" "),s("p",[t._v("先说明架构, 三个注册中心, 两个服务提供者, 一个消费者")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("名称")]),t._v(" "),s("th",[t._v("端口")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("reg-node01")]),t._v(" "),s("td",[t._v("9001")])]),t._v(" "),s("tr",[s("td",[t._v("reg-node02")]),t._v(" "),s("td",[t._v("9002")])]),t._v(" "),s("tr",[s("td",[t._v("reg-node03")]),t._v(" "),s("td",[t._v("9003")])]),t._v(" "),s("tr",[s("td",[t._v("provider-01")]),t._v(" "),s("td",[t._v("8001")])]),t._v(" "),s("tr",[s("td",[t._v("provider-02")]),t._v(" "),s("td",[t._v("8002")])]),t._v(" "),s("tr",[s("td",[t._v("consumer")]),t._v(" "),s("td",[t._v("9999")])])])]),t._v(" "),s("h2",{attrs:{id:"修改hosts映射"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改hosts映射"}},[t._v("#")]),t._v(" 修改hosts映射")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("127.0.0.1 reg-node01\n127.0.0.1 reg-node02\n127.0.0.1 reg-node03\n")])])]),s("h2",{attrs:{id:"注册中心配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注册中心配置"}},[t._v("#")]),t._v(" 注册中心配置")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("配置文件")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9001")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node01\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定主机名")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" reg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node01\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("register-with-eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fetch-registry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定其他注册中心地址")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//reg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("9002/eureka/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//reg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node03"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("9003/eureka/\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("management")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exposure")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n\n")])])])]),t._v(" "),s("li",[s("p",[t._v("其他的注册中心类似, 修改 "),s("code",[t._v("eureka.instance.hostname")]),t._v("  和 "),s("code",[t._v("端口")]),t._v(" ,同样指定其他注册中心的地址")])])]),t._v(" "),s("h2",{attrs:{id:"服务提供者配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务提供者配置"}},[t._v("#")]),t._v(" 服务提供者配置")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("指定所有注册中心的地址")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8001")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定多个中心的地址")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//reg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node01"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("9001/eureka/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//reg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node02"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("9002/eureka/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//reg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node03"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("9003/eureka/\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("management")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exposure")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("provider\n\n")])])])])]),t._v(" "),s("h1",{attrs:{id:"测试结果"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试结果"}},[t._v("#")]),t._v(" 测试结果")]),t._v(" "),s("ol",[s("li",[t._v("当一个服务注册时,  "),s("code",[t._v("所有注册中心")]),t._v(" 会发现服务,并且在本机注册")]),t._v(" "),s("li",[t._v("当某一台注册中心宕机或者异常, 其他注册中心依然可以提供服务发现")]),t._v(" "),s("li",[t._v("当机器重启之后,服务会自动注册")])]),t._v(" "),s("h1",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("HA机制在大数据领域应用比较广泛, 比如 "),s("code",[t._v("HDFS")]),t._v(" 的  "),s("code",[t._v("standby/secondaryNamenode")]),t._v(" ,  "),s("code",[t._v("Spark")]),t._v(" 的 "),s("code",[t._v("standby")]),t._v(" , "),s("code",[t._v("YARN")]),t._v(" 等等.")]),t._v(" "),s("p",[t._v("但是注册中心的冗余备份似乎并不是特别友好, 体现在以下几点:")]),t._v(" "),s("ol",[s("li",[t._v("注册中心之间, 需要相互注册, 这样势必会形成 N*N 的网状结构, 当然可以通过,先 纵向注册横、再横向注册,形成树状结构.")]),t._v(" "),s("li",[t._v("每个服务提供方也必须指定所有注册中心")]),t._v(" "),s("li",[t._v("只有同时满足 "),s("code",[t._v("1")]),t._v(" , "),s("code",[t._v("2")]),t._v(" 条件才能实现高可用.")])]),t._v(" "),s("h1",{attrs:{id:"思考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#思考"}},[t._v("#")]),t._v(" 思考")]),t._v(" "),s("p",[t._v("显然这个高可用注册中心十分不友好, 分析一下:")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("如果新增一台注册中心机器,我们要做什么?\n如果是树状结构, 可以在某个叶子节点下追加；如果是网状结构,那就很麻烦,要修改所有的注册中心配置文件.")])]),t._v(" "),s("li",[s("p",[t._v("如果新增一个服务我们要做什么?")]),t._v(" "),s("p",[t._v("每个服务提供者指定所有注册中心.")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);